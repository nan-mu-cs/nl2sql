Total # = 40

1. What are the ids of the top three products that were purchased in the largest amount?
P: Give the ids of the three products purchased in the largest amounts.

Select product_id
from product_suppliers
order by total_amount_purchased desc
limit 3

2. What are the product id and product type of the cheapest product?
P: Give the id and product type of the product with the lowest price.

select product_id, product_type_code
from products
order by product_price
limit 1

3. Find the number of different product types.
P: Count the number of distinct product types.

select count(distinct product_type_code)
from products

4. Return the address of customer 10.
P: What is the address for the customer with id 10?

Select T1.address_details
From addresses as T1 JOIN customer_addresses as T2 ON T1.address_id = T2.address_id
Where T2.customer_id = 10

5. What are the staff ids and genders of all staffs whose job title is Department Manager?
P: Return the staff ids and genders for any staff with the title Department Manager.

Select T1.staff_id, T1.staff_gender
From staff as T1 JOIN staff_department_assignments as T2 ON T1.staff_id = T2.staff_id
Where T2.job_title_code = "Department Manager"

6. For each payment method, return how many customers use it.
P: How many customers use each payment method?

Select payment_method_code, count(*)
From customers
Group by payment_method_code

7. What is the id of the product that was ordered the most often?
P: Give the product id for the product that was ordered most frequently.

Select product_id
From order_items
Group by product_id
Order by count(*) Desc
LIMIT 1

8. What are the name, phone number and email address of the customer who made the largest number of orders?
P: Return the name, phone number and email address for the customer with the most orders.

Select T1.customer_name, T1.customer_phone, T1.customer_email
From customers as T1 JOIN customer_orders as T2 ON T1.customer_id = T2.customer_id
Group by T2.customer_id
Order by count(*) Desc
LIMIT 1

9. What is the average price for each type of product?
P: Return the average price for each product type.

Select product_type_code, avg(product_price)
From products
Group by product_type_code

10. How many department stores does the store chain South have?
P: Count the number of stores the chain South has.

Select count(*)
From department_stores as T1 JOIN department_store_chain as T2 ON T1.dept_store_chain_id = T2.dept_store_chain_id
where T2.dept_store_chain_name = "South"

11. What is the name and job title of the staff who was assigned the latest?
P: Return the name and job title of the staff with the latest date assigned.

Select T1.staff_name, T2.job_title_code
From staff as T1 JOIN staff_department_assignments as T2 ON T1.staff_id = T2.staff_id
Order by T2.date_assigned_to Desc
LIMIT 1

12. Give me the product type, name and price for all the products supplied by supplier id 3.
P: Return the product type, name, and price for products supplied by supplier 3.

Select T2.product_type_code, T2.product_name, T2.product_price
From product_suppliers as T1 JOIN products as T2 ON T1.product_id = T2.product_id
Where T1.supplier_id = 3


13. Return the distinct name of customers whose order status is Pending, in the order of customer id.
P: What are the distinct names of customers with an order status of Pending, sorted by customer id?

Select Distinct T1.customer_name
From customers as T1 JOIN customer_orders as T2 ON T1.customer_id = T2.customer_id
Where T2.order_status_code = "Pending"
Order by T2.customer_id

14. Find the name and address of the customers who have both New and Pending orders.
P: What are the names and addressed of customers who have both New and Pending orders?

Select T1.customer_name, T1.customer_address
From customers as T1 JOIN customer_orders as T2 ON T1.customer_id = T2.customer_id
Where T2.order_status_code = "New"
INTERSECT
Select T1.customer_name, T1.customer_address
From customers as T1 JOIN customer_orders as T2 ON T1.customer_id = T2.customer_id
Where T2.order_status_code = "Pending"


15. Return ids of all the products that are supplied by supplier id 2 and are more expensive than the average price of all products.
P: What are the ids of products from the supplier with id 2, which are more expensive than the average price across all products?

Select T1.product_id
From product_suppliers as T1 JOIN products as T2 ON T1.product_id = T2.product_id
Where T1.supplier_id = 2 and T2.product_price > (Select avg(product_price) From products)

16. What is the id and name of the department store that has both marketing and managing department?
P: What are the ids and names of department stores with both marketing and managing departments?

Select T2.dept_store_id, T2.store_name
From departments as T1 JOIN department_stores as T2 ON T1.dept_store_id = T2.dept_store_id
Where T1.department_name = "marketing"
INTERSECT
Select T2.dept_store_id, T2.store_name
From departments as T1 JOIN department_stores as T2 ON T1.dept_store_id = T2.dept_store_id
Where T1.department_name = "managing"

17. What are the ids of the two department store chains with the largest number of department stores?
P: Return the ids of the two department store chains with the most department stores.

Select dept_store_chain_id
From department_stores
Group by dept_store_chain_id
Order by count(*) Desc
LIMIT 2

18. What is the id of the department with the least number of staff?
P: Return the id of the department with the fewest staff assignments.

Select department_id
From staff_department_assignments
Group by department_id
Order by count(*)
LIMIT 1


19. For each product type, return the maximum and minimum price.
P: What are the maximum and minimum product prices for each product type?

Select product_type_code, max(product_price), min(product_price)
From products
Group by product_type_code


20. Find the product type whose average price is higher than the average price of all products.
P: What is the code of the product type with an average price higher than the average price of all products?

Select product_type_code
From products
Group by product_type_code
Having avg(product_price) > (Select avg(product_price) From products)


21. Find the id and name of the staff who has been assigned for the shortest period.
P: What is the id and name of the staff who has been assigned for the least amount of time?

Select T1.staff_id, T1.staff_name
from staff as T1 JOIN Staff_Department_Assignments as T2 ON T1.staff_id = T2.staff_id
Order by date_assigned_to - date_assigned_from
LIMIT 1

22. Return the names and ids of all products whose price is between 600 and 700.
P: What are the names and ids of products costing between 600 and 700?

Select product_name, product_id
From products
Where product_price between 600 and 700

23.  Find the ids of all distinct customers who made order after some orders that were Cancelled.
P: What are the distinct ids of customers who made an order after any order that was Cancelled?

Select distinct customer_id
From Customer_Orders
Where order_date > (select min(order_date) from Customer_Orders where order_status_code = "Cancelled")


24. What is id of the staff who had a Staff Department Assignment earlier than any Clerical Staff?
P: Return the id of the staff whose Staff Department Assignment was earlier than that of any Clerical Staff.

Select staff_id
From Staff_Department_Assignments
Where date_assigned_to < (select max(date_assigned_to) from Staff_Department_Assignments where job_title_code = 'Clerical Staff')

25. What are the names and ids of customers whose address contains TN?
P: Return the names and ids of customers who have TN in their address.

Select customer_name, customer_id
From customers
Where customer_address LIKE "%TN%"

26. Return the name and gender of the staff who was assigned in 2016.
P: What are the names and genders of staff who were assigned in 2016?

Select T1.staff_name, T1.staff_gender
From staff as T1 JOIN staff_department_assignments as T2 ON T1.staff_id = T2.staff_id
Where T2.date_assigned_from LIKE "2016%"

27. List the name of staff who has been assigned multiple jobs.
P: What are the names of staff who have been assigned multiple jobs?

Select T1.staff_name
From staff as T1 JOIN staff_department_assignments as T2 ON T1.staff_id = T2.staff_id
Group by T2.staff_id
Having count (*) > 1

28. List the name and phone number of all suppliers in the alphabetical order of their addresses.
P: What are the names and phone numbers for all suppliers, sorted in alphabetical order of their addressed?

Select T1.supplier_name, T1.supplier_phone
From Suppliers as T1 JOIN supplier_addresses as T2 ON T1.supplier_id = T2.supplier_id JOIN addresses as T3 ON T2.address_id = T3.address_id
Order by T3.address_details

29. What are the phone numbers of all customers and suppliers.
P: Return the phone numbers for all customers and suppliers.

Select customer_phone
From customers
UNION
Select supplier_phone
From suppliers


30. Return the ids of all products that were ordered more than three times or supplied more than 80000.
P: What are the ids of all products that were either ordered more than 3 times or have a cumulative amount purchased of above 80000?

Select product_id
From Order_Items
Group by product_id
Having count(*) > 3
UNION
Select product_id
From Product_Suppliers
Group by product_id
Having sum(total_amount_purchased) > 80000


31. What are id and name of the products whose price is lower than 600 or higher than 900?
P: Give the ids and names of products with price lower than 600 or higher than 900.

Select product_id, product_name
From products
where product_price < 600 or product_price > 900


32. Find the id of suppliers whose average amount purchased for each product is above 50000 or below 30000.
P: What are the ids of suppliers which have an average amount purchased of above 50000 or below 30000?

Select supplier_id
From Product_Suppliers
Group by supplier_id
Having avg(total_amount_purchased) > 50000 or avg(total_amount_purchased) < 30000


33. What are the average amount purchased and value purchased for the supplier who supplies the most products.
P: Return the average total amount purchased and total value purchased for the supplier who supplies the greatest number of products.

Select avg(total_amount_purchased), avg(total_value_purchased)
From Product_Suppliers
Where supplier_id = (Select supplier_id From Product_Suppliers Group by supplier_id Order by count(*) Desc LIMIT 1)


34. What is the largest and smallest customer codes?
P: Return the maximum and minimum customer codes.

Select max(customer_code), min(customer_code)
From Customers


35. List the names of all the distinct customers who bought a keyboard.
P: What are the distinct names of customers who have purchased a keyboard?

Select Distinct T1.customer_name
From customers as T1 JOIN customer_orders as T2 ON T1.customer_id = T2.customer_id JOIN order_items as T3 ON T2.order_id = T3.order_id JOIN products as T4 ON T3.product_id = T4.product_id
Where T4.product_name = "keyboard"


36. List the names and phone numbers of all the distinct suppliers who supply red jeans.
P: What are the distinct names and phone numbers for suppliers who have red jeans?

Select Distinct T1.supplier_name, T1.supplier_phone
From suppliers as T1 JOIN product_suppliers as T2 ON T1.supplier_id = T2.supplier_id JOIN products as T3 ON T2.product_id = T3.product_id
Where T3.product_name = "red jeans"

37.  What are the highest and lowest prices of products, grouped by and alphabetically ordered by product type?
P: Give the maximum and minimum product prices for each product type, grouped and ordered by product type.

Select max(product_price), min(product_price), product_type_code
From products
group by product_type_code
order by product_type_code


38. List the order id, customer id for orders in Cancelled status, ordered by their order dates.
P: What are the order ids and customer ids for orders that have been Cancelled, sorted by their order dates?

Select order_id, customer_id
From customer_orders
where order_status_code =  "Cancelled"
Order by order_date


39. Find the names of products that were bought by at least two distinct customers.
P: What are the distinct names of products purchased by at least two different customers?

Select Distinct T3.product_name
From customer_orders as T1 JOIN order_items as T2 ON T1.order_id = T2.order_id JOIN products as T3 ON T2.product_id = T3.product_id
Group by T3.product_id
Having count (distinct T1.customer_id) >= 2


40. Find the names of customers who have bought by at least three distinct products.
P: What are the distinct names of customers who have purchased at least three different products?

Select Distinct T1.customer_name
From customers as T1 JOIN customer_orders as T2 ON T1.customer_id = T2.customer_id JOIN order_items as T3 ON T2.order_id = T3.order_id
Group by T1.customer_id
Having count (distinct T3.product_id) >= 3


41. Find the name and gender of the staff who has been assigned the job of Sales Person but never Clerical Staff.
P: What are the names and genders of staff who have held the title Sales Person, but never Clerical Staff?

Select T1.staff_name, T1.staff_gender
From staff as T1 JOIN Staff_Department_Assignments as T2 ON T1.staff_id = T2.staff_id
where T2.job_title_code = "Sales Person"
EXCEPT
Select T1.staff_name, T1.staff_gender
From staff as T1 JOIN Staff_Department_Assignments as T2 ON T1.staff_id = T2.staff_id
where T2.job_title_code = "Clerical Staff"


42. Find the id and name of customers whose address contains WY state and do not use credit card for payment.
P: What are the ids and names of customers with addressed that contain WY and who do not use a credit card for payment?

Select customer_id, customer_name
From customers
Where customer_address LIKE "%WY%" and payment_method_code != "Credit Card"

43. Find the average price of all product clothes.
P: What is the average price of clothes?

Select avg(product_price)
from products
where product_type_code = 'Clothes'

44. Find the name of the most expensive hardware product.
P: What is the name of the hardware product with the greatest price?

Select product_name
from products
where product_type_code = 'Hardware'
order by product_price desc
limit 1
