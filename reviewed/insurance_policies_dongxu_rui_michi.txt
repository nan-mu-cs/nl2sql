# count = 25 (only 5 tables, 4 foreign keys)

1. Which settlement has a settlement amount not equal to the average and caused more than one payment? List the settlement id, claim date and date settled.
P: Find the settlement id, claim date and date settled for the settlement that has a settlement amount not equal to the average and caused more than one payment.

select T1.Settlement_id, T1.Date_claim_made, T1.Date_Claim_Settled
from Settlements as T1 JOIN Payments as T2
on T1.Settlement_id = T2.Settlement_id
where Amount_Settled <> (
select avg(Amount_Settled)
from Settlements
)
group by T1.Settlement_id
having count(*) > 1

S:
S:
S:


2. Which claims caused more than 2 settlements or have the maximum claim value? List the date the claim was made and the claim id.
P: Find the claims that led to more than two settlements or have the maximum claim value. For each of them, return the date the claim was made and the id of the claim.

select T1.Date_Claim_Made, T1.Claim_id
from Claims as T1 JOIN Settlements as T2
on T1.Claim_id = T2.Claim_id
group by T1.Claim_id
having count(*) > 2
UNION
select T1.Date_Claim_Made, T1.Claim_id
from Claims as T1 JOIN Settlements as T2
on T1.Claim_id = T2.Claim_id
where T1.Amount_Claimled = (
select max(Amount_Claimled)
from Claims
)

S:
S:
S:


3. Which customer had at least 2 policies but did not file any claims? List the customer details and id.
P: Give me the the customer details and id for the customers who had two or more policies but did not file any claims.

select T1.customer_details, T1.customer_id
from Customers as T1 JOIN Customer_Policies as T2
on T1.Customer_id = T2.customer_id
group by T1.customer_id
having count(*) >= 2
EXCEPT
select T1.customer_details, T1.customer_id
from Customers as T1 JOIN Customer_Policies as T2
on T1.Customer_id = T2.customer_id
JOIN Claims as T3
on T2.policy_id = T3.policy_id

S:
S:
S:


4. List the method, date and amount of all the payments, in ascending order of date.
P: What are the method, date and amount of each payment? Sort the list in ascending order of date.

select Payment_Method_Code, Date_Payment_Made, Amount_Payment
from Payments
order by Date_Payment_Made asc

S:
S:
S:


5. Among all the claims, what is the settlement amount of the claim with the largest claim amount? List both the settlement amount and claim amount.
P: Find the settlement amount of the claim with the largest claim amount. Show both the settlement amount and claim amount.

select Amount_Settled, Amount_Claimled
from Claims
order by Amount_Claimled desc limit 1

S:
S:
S:


6. Among all the claims, what is the amount claimed in the claim with the least amount settled? List both the settlement amount and claim amount.
P: Find the claimed amount in the claim with the least amount settled. Show both the settlement amount and claim amount.

select Amount_Settled, Amount_Claimled
from Claims
order by Amount_Settled asc limit 1

S:
S:
S:


7. Among all the claims, which claims have a claimed amount larger than the average? List the date the claim was made and the date it was settled.
P: Give me the claim date, settlement date for all the claims whose claimed amount is larger than the average.

select Date_Claim_Made, Date_Claim_Settled
from Claims
where Amount_Claimled >
(
select avg(Amount_Claimled)
from Claims
)

S:
S:
S:


8. Among all the claims, which settlements have a claimed amount that is no more than the average? List the claim start date.
P: Return the claim start date for the claims whose claimed amount is no more than the average

select Date_Claim_Made
from Claims
where Amount_Settled <=
(
select avg(Amount_Settled)
from Claims
)

S:
S:
S:


9. How many settlements does each claim correspond to? List the claim id and the number of settlements.
P: Find the number of settlements each claim corresponds to. Show the number together with the claim id.

select T1.Claim_id, count(*)
from Claims as T1 JOIN Settlements as T2
on T1.claim_id = T2.claim_id
group by T1.claim_id

S:
S:
S:


10. Which claim incurred the most number of settlements? List the claim id, the date the claim was made, and the number.
P: Find the claim id and claim date of the claim that incurred the most settlement count.

Also tell me the count.
select T1.claim_id, T1.date_claim_made, count(*)
from Claims as T1 JOIN Settlements as T2
on T1.claim_id = T2.claim_id
group by T1.claim_id
order by count(*) desc limit 1

S:
S:
S:


11. How many settlements were made on the claim with the most recent claim settlement date? List the number and the claim id.
P: Find the claim id and the number of settlements made for the claim with the most recent settlement date.

select count(*), T1.claim_id
from Claims as T1 JOIN Settlements as T2
on T1.claim_id = T2.claim_id
group by T1.claim_id
order by T1.Date_Claim_Settled desc limit 1

S:
S:
S:


12. Of all the claims, what was the earliest date when any claim was made?
P: Tell me the the date when the first claim was made.

select Date_Claim_Made
from Claims
order by Date_Claim_Made asc limit 1

S:
S:
S:


13. What is the total amount of settlement made for all the settlements?
P: Compute the total amount of settlement across all the settlements.

select sum(Amount_Settled)
from Settlements

S:
S:
S:


14. Who are the customers that had more than 1 policy? List the customer details and id.
P: Find the the customer details and id for the customers who had more than one policy.

select T1.customer_details, T1.customer_id
from Customers as T1 JOIN Customer_Policies as T2
on T1.Customer_id = T2.Customer_id
group by T1.customer_id
having count(*) > 1

S:
S:
S:


15. What are the claim dates and settlement dates of all the settlements?
P: Tell me the the claim date and settlement date for each settlement case.

select Date_Claim_Made, Date_Claim_Settled
from Settlements

S:
S:
S:


16. What is the most popular payment method?
P: Which payment method is used the most often?

select Payment_Method_Code
from Payments
group by Payment_Method_Code
order by count(*) desc limit 1

S:
S:
S:


17. With which kind of payment method were the least number of payments processed?
P: What is the payment method that were used the least often?

select Payment_Method_Code
from Payments
group by Payment_Method_Code
order by count(*) asc limit 1

S:
S:
S:


18. What is the total amount of payment?
P: Compute the total amount of payment processed.

select sum(Amount_Payment)
from Payments

S:
S:
S:


19. What are all the distinct details of the customers?
P: Return the distinct customer details.

select distinct customer_details
from Customers

S:
S:
S:


20. Which kind of policy type was chosen by the most customers?
P: Find the policy type the most customers choose.

select Policy_Type_Code
from Customer_Policies
group by Policy_Type_Code
order by count(*) desc limit 1

S:
S:
S:


21. How many settlements are there in total?
P: Count the total number of settlements made.

select count(*)
from Settlements

S:
S:
S:


22. Which Payments were processed with Visa? List the payment Id, the date and the amount.
P: Give me the payment Id, the date and the amount for all the payments processed with Visa.

select Payment_ID, Date_Payment_Made, Amount_Payment
from Payments
where Payment_Method_Code = 'Visa'

S:
S:
S:


23. List the details of the customers who do not have any policies.
P: Which customers do not have any policies? Find the details of these customers.

select customer_details
from Customers
EXCEPT
select T1.customer_details
from Customers as T1 JOIN Customer_Policies as T2
on T1.customer_id = T2.customer_id

S:
S:
S:


24. List the date the claim was made, the date it was settled and the amount settled for all the claims which had exactly one settlement.
P: Which claims had exactly one settlement? For each, tell me the the date the claim was made, the date it was settled and the amount settled.

select T1.claim_id, T1.date_claim_made, T1.Date_Claim_Settled
from Claims as T1 JOIN Settlements as T2
on T1.Claim_id = T2.Claim_id
group by T1.claim_id
having count(*) = 1

S:
S:
S:


25. Find the total claimed amount of all the claims.
P: What is total amount claimed summed across all the claims?

select sum(Amount_Claimed)
from Claims

S:
S:
S:


